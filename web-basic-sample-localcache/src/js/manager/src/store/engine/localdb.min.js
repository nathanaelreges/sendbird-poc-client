!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LocalDB=t():e.LocalDB=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Command={NOOP:"/noop",REGEX:"/regex",IS_NULL:"/null",WHERE:"/where",IN:"/in",NOT_IN:"/nin",INCLUDE:"/include",EXCLUDE:"/exclude",EQUAL:"==",EXACTLY_EQUAL:"===",NOT_EQUAL:"!=",NOT_EXACTLY_EQUAL:"!==",GREATER:">",GREATER_OR_EQUAL:">=",LESS:"<",LESS_OR_EQUAL:"<=",DELETE:"/delete"}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handlers={}}return r(e,[{key:"has",value:function(e){return this.handlers[e]&&this.handlers[e].length>0}},{key:"trigger",value:function(e){if(this.handlers[e]){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i in this.handlers[e]){var o;(o=this.handlers[e])[i].apply(o,n)}}}},{key:"on",value:function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)}},{key:"off",value:function(e,t){if(this.handlers.hasOwnProperty(e))if(t){for(var n in this.handlers[e])if(this.handlers[e][n]===t){this.handlers[e].splice(n,1);break}}else this.handlers[e]=[]}}]),e}();t.EventHandler=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0);var a=new WeakMap,s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=t,this.conditions=n||{};var i={};for(var s in this.conditions){i[s]=[];var l=this.conditions[s];if("object"===(void 0===l?"undefined":r(l))){for(var u in o.Command)l.hasOwnProperty(o.Command[u])&&i[s].push(o.Command[u]);null===l&&i[s].push(o.Command.IS_NULL)}else i[s].push(o.Command.EXACTLY_EQUAL)}a.set(this,i)}return i(e,[{key:"getOperators",value:function(e){return a.get(this)[e]}},{key:"match",value:function(t){var n=this.db.getItem(t);if(n){var i=0,a=0;for(var s in this.conditions){var l=this.getOperators(s,this.conditions[s]);i+=l.length;var u=e.getValueForColumn(n,s);for(var c in l){var f=l[c];switch(f){case o.Command.EQUAL:u==this.conditions[s][f]&&a++;break;case o.Command.EXACTLY_EQUAL:this.conditions[s].hasOwnProperty(f)?u===this.conditions[s][f]&&a++:u===this.conditions[s]&&a++;break;case o.Command.NOT_EQUAL:u!=this.conditions[s][f]&&a++;break;case o.Command.NOT_EXACTLY_EQUAL:u!==this.conditions[s][f]&&a++;break;case o.Command.GREATER:u>this.conditions[s][f]&&a++;break;case o.Command.GREATER_OR_EQUAL:u>=this.conditions[s][f]&&a++;break;case o.Command.LESS:u<this.conditions[s][f]&&a++;break;case o.Command.LESS_OR_EQUAL:u<=this.conditions[s][f]&&a++;break;case o.Command.IS_NULL:null===u&&a++;break;case o.Command.REGEX:var h=this.conditions[s][f];h instanceof RegExp&&"string"==typeof u&&h.test(u)&&a++;break;case o.Command.IN:var d=this.conditions[s][f];Array.isArray(d)&&d.indexOf(u)>=0&&a++;break;case o.Command.NOT_IN:var y=this.conditions[s][f];Array.isArray(y)&&y.indexOf(u)<0&&a++;break;case o.Command.INCLUDE:var v=this.conditions[s][f];if(Array.isArray(u))if(v&&"object"===(void 0===v?"undefined":r(v)))for(var m in u){var b=0;for(var p in v){e.getValueForColumn(u[m],p)===e.getValueForColumn(v,p)&&b++}if(b===Object.keys(v).length){a++;break}}else u.indexOf(v)>=0&&a++;break;case o.Command.EXCLUDE:var g=this.conditions[s][f];if(Array.isArray(u))if(g&&"object"===(void 0===g?"undefined":r(g))){var E=!1;for(var k in u){var T=0;for(var w in g){e.getValueForColumn(u[k],w)===e.getValueForColumn(g,w)&&T++}if(T===Object.keys(g).length){E=!0;break}}E||a++}else u.indexOf(g)<0&&a++;break;case o.Command.WHERE:var O=this.conditions[s][f];"function"==typeof O&&O(u)&&a++}}}return a===i}return!1}}],[{key:"getValueForColumn",value:function(e,t){var n=e[t];if(t.indexOf(".")>=0){var r=t.split(".");for(var i in n=e,r){if(!n[r[i]])return null;n=n[r[i]]}}return n}}]),e}();t.Filter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(5),a=n(0),s=n(2),l=n(6),u=n(7),c=n(8),f=n(9),h=n(10),d=n(11),y=n(12),v=n(3);var m="-sbm",b="__meta__",p=new o.Config,g=new h.Indexer,E=new y.TableMapper,k=new u.StorageEngine(p),T=new c.StorageManager(p),w={},O={},_={root:{},meta:{tb:{},tbmap:{}},totalCount:0,flush:function(e){w[e]||(w[e]=new f.BatchUpdater(function(){if(e!==b){var t=_.encrypt(JSON.stringify(_.root[e]),e);k.setItem("-sbt-"+e,t);var n=t.length;if(g.indexTable[e]){var r=_.encrypt(JSON.stringify(g.indexTable[e]||{}),e);n+=r.length,k.setItem("-sbi-"+e,r)}T.setUsedByTable(e,n)}_.meta.tbmap=E.get(),k.setItem(m,JSON.stringify({meta:_.meta,storage:{meta:T.usedByTable,user:T.usedByUser}})),T.checkEviction()},p.batchInterval)),w[e].run()},fetch:function(e){var t=_.decrypt(k.getItem("-sbt-"+e),e),n=k.getItem("-sbi-"+e);n&&(n=_.decrypt(n,e),g.indexTable[e]=JSON.parse(n)),_.root[e]=JSON.parse(t),_.meta.tb[e].count=Object.keys(_.root[e]).length,_.totalCount+=_.meta.tb[e].count},encrypt:function(e,t){return p.encryption?p.encryption.encrypt(e,p.encryption.salt(t)):e},decrypt:function(e,t){return p.encryption?p.encryption.decrypt(e,p.encryption.salt(t)):e}},L=function(e,t,n){e[t]=n,n&&"object"===(void 0===n?"undefined":i(n))&&n.hasOwnProperty(a.Command.DELETE)&&n[a.Command.DELETE]&&delete e[t]},x=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t?t.tableName:null;if(n||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_TABLE_NAME),t||(t={}),this.table=E.yield(n),this.handlers=new s.EventHandler,_.root[this.table]){var r=_.meta.tb[this.table];t.hasOwnProperty("tableItemLimit")&&(r.limit=t.tableItemLimit),t.hasOwnProperty("dependency")&&(r.dependency=t.dependency),t.hasOwnProperty("timestampColumn")&&(r.timestampColumn=t.timestampColumn),t.hasOwnProperty("kickoutDelay")&&(r.kickoutDelay=t.kickoutDelay),_.flush(b)}else{if(_.root[this.table]={},t.dependency&&"object"===i(t.dependency)){var o={};for(var a in t.dependency){o[E.yield(a)]=t.dependency[a],this.ensureIndex([t.dependency[a].key])}t.dependency=o}if(_.meta.tb[this.table]={count:0,limit:t.tableItemLimit||p.defaultTableItemLimit,dependency:t.dependency||{},kickoutDelay:t.kickoutDelay||p.defaultKickoutDelay},t.index&&Array.isArray(t.index))for(var u in t.index)Array.isArray(t.index[u])&&this.ensureIndex(t.index[u]);k.setItem(m,JSON.stringify(_.meta)),_.flush(this.table)}O[this.table]=this}return r(e,null,[{key:"config",value:function(e){e||(e={}),e.encryption&&e.encryption.encrypt&&e.encryption.decrypt&&e.encryption.salt&&(p.encryption=e.encryption),e.hasOwnProperty("batchInterval")&&"number"==typeof e.batchInterval&&(p.batchInterval=e.batchInterval),e.hasOwnProperty("memcacheLimit")&&"number"==typeof e.memcacheLimit&&(p.memcacheLimit=e.memcacheLimit),e.hasOwnProperty("storageLimit")&&"number"==typeof e.storageLimit&&(p.storageLimit=e.storageLimit),e.hasOwnProperty("storageEvictionBuffer")&&"number"==typeof e.storageEvictionBuffer&&(p.storageEvictionBuffer=e.storageEvictionBuffer),e.hasOwnProperty("storageEvictionPolicy")&&(p.storageEvictionPolicy=e.storageEvictionPolicy),e.hasOwnProperty("totalLimit")&&"number"==typeof e.totalLimit&&(p.totalLimit=e.totalLimit),e.hasOwnProperty("defaultTableItemLimit")&&"number"==typeof e.defaultTableItemLimit&&(p.defaultTableItemLimit=e.defaultTableItemLimit),e.hasOwnProperty("defaultKickoutDelay")&&"number"==typeof e.defaultKickoutDelay&&(p.defaultKickoutDelay=e.defaultKickoutDelay);var t=k.getItem(m);if(t){var n=JSON.parse(t);_.meta=n.meta,T.usedByTable=n.storage.meta,T.usedByUser=n.storage.user,E.set(_.meta.tbmap)}for(var r in _.meta.tb)_.fetch(r);T.onEvict(function(e){e+=p.storageEvictionBuffer;var t=[],n=[];switch(p.storageEvictionPolicy){case o.Config.StorageEvictionPolicy.ROUND_ROBIN:case o.Config.StorageEvictionPolicy.EVEN_BREAK:break;case o.Config.StorageEvictionPolicy.CASCADE:for(var r in _.root){var i=_.meta.tb[r];i.dependency&&0!==Object.keys(i.dependency).length||t.push({name:r,fs:_.root[r]})}break;default:for(var a in _.root)t.push({name:a,fs:_.root[a]})}for(var s in t){var l=t[s];for(var u in l.fs){var c=l.fs[u];if(e>0){var f=!1;for(var h in n)if(n[h].item.tsp<c.tsp){f=!0,n.splice(h,0,{table:l.name,key:u,item:c});break}for(f||n.push({table:l.name,key:u,item:c}),e-=c.kvs;e+n[n.length-1].item.kvs<0;){e+=n.pop().item.kvs}}}}for(var d in n){var y=O[n[d].table];y&&y.removeItem(n[d].key,{evicted:!0,deferred:!0})}})}},{key:"getTableInstance",value:function(t,n){n||(n={});var r=E.yield(t);return O[r]||new e(t,n),O[r]}},{key:"limit",get:function(){return p.totalLimit}},{key:"storageUsed",get:function(){return T.usedBySystem+T.usedByUser}},{key:"storageLimit",get:function(){return p.storageLimit}},{key:"kickoutDelay",get:function(){return p.kickoutDelay}}]),r(e,[{key:"count",value:function(e){if(e){var t=0,n=new v.Filter(this,e);for(var r in _.root[this.table])n.match(r)&&t++;return t}return _.meta.tb[this.table].count}},{key:"ensureIndex",value:function(e){if(g.createIndex(this.table,e))for(var t in _.root[this.table]){var n=this.getItem(t);g.put(this.table,t,n)}_.flush(this.table)}},{key:"removeIndex",value:function(e){g.removeIndex(this.table,e),_.flush(this.table)}},{key:"findOne",value:function(e,t){e.options||(e.options={}),e.options.limit=1,this.query(e).execute(function(e,n){t(e,n.length>0?n[0]:null)})}},{key:"find",value:function(e,t){this.query(e).execute(t)}},{key:"query",value:function(e){var t=this,n=null,r=null,i={setCondition:function(e){n=e||{}},setOption:function(e){"number"!=typeof(r=e||{}).offset&&(r.offset=0),"number"!=typeof r.limit&&(r.limit=20),"boolean"==typeof r.desc&&(r.reversed=r.desc),r.offset<0&&(r.offset=0),r.limit<0&&(r.offset=20)},execute:function(e){var i=Object.keys(n);r.orderBy&&"string"==typeof r.orderBy&&i.push(r.orderBy);var o=[],a=new v.Filter(t,n);if(g.findAppropriateIndexedColumns(t.table,i,a).length>0){var s=g.queryKeys(t.table,i,a,r);for(var l in s)o.push(t.getItem(s[l]))}else if(r.orderBy){var u=[];for(var c in _.root[t.table])a.match(c)&&u.push(t.getItem(c));u.sort(function(e,t){return e[r.orderBy]>t[r.orderBy]?r.desc?-1:1:e[r.orderBy]<t[r.orderBy]?r.desc?1:-1:0}),o=u.slice(r.offset,r.offset+r.limit)}else for(var f in _.root[t.table])if(0===r.offset?a.match(f)&&o.push(t.getItem(f)):r.offset--,o.length===r.limit)break;e(null,o)}};return e||(e={}),i.setCondition(e.condition),i.setOption(e.options),i}},{key:"hasItem",value:function(e){return e||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_KEY),!!_.root[this.table][e]}},{key:"getItem",value:function(e,t){e||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_KEY),t||(t={});var n=_.root[this.table][e]?_.root[this.table][e].lsk:null;if(n){var r=k.getItem(n),i=new d.Serializer(r,_.root[this.table][e].dtp);return _.decrypt(i.deserialize(),e+this.table)}return null}},{key:"setItem",value:function(e,t,n){e||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_KEY),n||(n={});var r=_.meta.tb[this.table],o=this.count(),a=!_.root[this.table][e];if(a&&(r.limit<o+1||p.totalLimit<_.totalCount+1)){var s=null,u=null;for(var c in _.root[this.table])u?u.tsp>_.root[this.table][c].tsp&&(s=c,u=_.root[this.table][c]):(s=c,u=_.root[this.table][c]);s&&this.removeItem(s,{evicted:!0,deferred:!0})}var f=null,h=new d.Serializer(t),y=(new Date).getTime();r.timestampColumn&&t&&"object"===(void 0===t?"undefined":i(t))&&("number"==typeof t[""+r.timestampColumn]?y=t[""+r.timestampColumn]||y:l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_TABLE_NAME));var v=h.serialize();if(_.root[this.table][e]?(f=_.root[this.table][e].lsk,_.root[this.table][e].tsp=y):(f=function(e,t){return _.encrypt("-"+e+"-"+t,t+e)}(this.table,e),_.root[this.table][e]={lsk:f,tsp:y}),f){var m=a?null:this.getItem(e),b=v,E=_.encrypt(b,e+this.table);if(_.root[this.table][e].dtp=h.type,_.root[this.table][e].kvs=f.length+E.length,k.setItem(f,E),a)r.count++,_.totalCount++,T.increaseUserDataUsage(f.length+E.length);else{g.remove(this.table,e,m);var w=new d.Serializer(m),O=_.encrypt(w.serialize(),e+this.table),L=E.length-O.length;L>0?T.increaseUserDataUsage(L):L<0&&T.decreaseUserDataUsage(L)}return g.put(this.table,e,t),_.flush(this.table),a?this.handlers.trigger("insert",e,t):this.handlers.trigger("update",e,m,t),a}return l.LocalDBError.throw(l.LocalDBError.Type.ERROR_FAILED_TO_GENERATE_KEY),!1}},{key:"updateItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];e||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_KEY),n||(n={});var r=this.getItem(e);if(null!==r){for(var i in t)L(r,i,t[i]);this.setItem(e,r)}else l.LocalDBError.throw(l.LocalDBError.Type.ERROR_KEY_NOT_FOUND)}},{key:"removeItem",value:function(e,t){e||l.LocalDBError.throw(l.LocalDBError.Type.ERROR_EMPTY_KEY),t||(t={});var n=_.root[this.table][e]?_.root[this.table][e].lsk:null;if(n){var r=this.getItem(e),i=_.encrypt(r,e+this.table),o=_.meta.tb[this.table];for(var a in t.deferred?setTimeout(function(){k.removeItem(n)},o.kickoutDelay):k.removeItem(n),(this.handlers.has("remove")||t.evicted&&this.handlers.has("evict"))&&(this.handlers.trigger("remove",e,r),t.evicted&&this.handlers.trigger("evict",e,r)),delete _.root[this.table][e],o.count--,_.totalCount--,g.remove(this.table,e,r),_.meta.tb){var s=_.meta.tb[a].dependency;if(s&&s[this.table]&&s[this.table].constraint){var u=O[a],c=s[this.table].key;if(u)for(var f in u.keys){u.getItem(f)[c]===e&&u.removeItem(f,{deferred:!0})}}}i&&T.decreaseUserDataUsage(n.length+i.length),_.flush(this.table)}}},{key:"updateAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];this.updateIf({},e,t)}},{key:"updateIf",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],i=[],o=e?new v.Filter(this,e):null;Object.keys(_.root[this.table]).forEach(function(e){i.push(new Promise(function(r){if(!o||o.match(e)){var i=t.getItem(e);for(var a in n)L(i,a,n[a]);t.setItem(e,i)}r()}))}),Promise.all(i).then(function(){return r?r():null})}},{key:"removeIf",value:function(e,t,n){var r=this;if(e){var i=[],o=new v.Filter(this,e);Object.keys(_.root[this.table]).forEach(function(e){i.push(new Promise(function(n){o.match(e)&&r.removeItem(e,t),n()}))}),Promise.all(i).then(function(){return n?n():null})}else this.clear(n)}},{key:"clear",value:function(e){var t=this,n=[];Object.keys(_.root[this.table]).forEach(function(e){n.push(new Promise(function(n){var r=_.root[t.table][e]?_.root[t.table][e].lsk:null;r&&k.removeItem(r),n()}))}),Promise.all(n).then(function(){g.reset(t.table),T.resetUserDataUsage(),_.totalCount-=_.meta.tb[t.table].count,_.meta.tb[t.table].count=0,_.root[t.table]={},_.flush(t.table),t.handlers.trigger("clear"),e&&e()})}},{key:"on",value:function(e,t){this.handlers.on(e,t)}},{key:"off",value:function(e,t){this.handlers.off(e,t)}},{key:"keys",get:function(){return _.root[this.table]}},{key:"limit",get:function(){var e=_.meta.tb[this.table];return e?e.limit:p.defaultTableItemLimit}},{key:"index",get:function(){return _.meta.tb[this.table].index}}]),e}();t.default=x},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=1048576,i=2e3,o=3e3,a=Number.MAX_VALUE,s=Number.MAX_VALUE,l=function(){var e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),t=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,n="undefined"!=typeof InstallTrigger,i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=!!document.documentMode,a=!o&&!!window.StyleMedia,s=!!window.chrome&&!!window.chrome.webstore;return.8*(s||n||t||o||a?10*r:i?5*r:e?2*r:5*r)}(),u=256,c="undefined"!=typeof window&&window.localStorage?window.localStorage:e.localStorage,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.batchInterval=i,this.storageEngine=c,this.storageLimit=l,this.storageEvictionBuffer=u,this.storageEvictionPolicy=e.StorageEvictionPolicy.DEFAULT,this.totalLimit=a,this.defaultTableItemLimit=s,this.defaultKickoutDelay=o,this.encryption=null}return n(e,null,[{key:"StorageEvictionPolicy",get:function(){return{DEFAULT:"default",ROUND_ROBIN:"round-robin",EVEN_BREAK:"even-break",CASCADE:"cascade"}}}]),e}();t.Config=f}).call(t,n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i={ERROR_EMPTY_TABLE_NAME:{code:100,message:"Table name should not be empty."},ERROR_EMPTY_KEY:{code:101,message:"Key should be provided."},ERROR_FAILED_TO_GENERATE_KEY:{code:102,message:"Failed to generate localStorage key."},ERROR_MAX_STORAGE_LIMIT_EXCEEDED:{code:103,message:"Maximum storage limit exceeded."},ERROR_KEY_NOT_FOUND:{code:104,message:"Key not found."}},o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"function"==typeof Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=new Error(e).stack,r.name="LocalDBError",r.message=e,r.code=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),r(t,null,[{key:"throw",value:function(e){if(e)throw new t(e.message,e.code)}},{key:"Type",get:function(){return i}}]),t}();t.LocalDBError=o},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var r=new WeakMap,i=function(){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=n,this.config.storageEngine?r.set(this,this.config.storageEngine):"undefined"!=typeof window&&window.localStorage?r.set(this,window.localStorage):void 0!==e&&e.localStorage&&r.set(this,e.localStorage)}return n(t,[{key:"getItem",value:function(e){var t=r.get(this);return t?t.getItem(e):null}},{key:"setItem",value:function(e,t){var n=r.get(this);n&&n.setItem(e,t)}},{key:"removeItem",value:function(e){var t=r.get(this);t&&t.removeItem(e)}},{key:"clear",value:function(){var e=r.get(this);e&&e.clear()}},{key:"length",get:function(){var e=r.get(this);return e?e.length:0}}]),t}();t.StorageEngine=i}).call(t,n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2);var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.usedByTable={},this.usedByUser=0,this.handlers=new i.EventHandler}return r(e,[{key:"checkEviction",value:function(){this.exceeded>0&&this.handlers.trigger("evict",this.exceeded)}},{key:"setUsedByTable",value:function(e,t){this.usedByTable[e]=t}},{key:"increaseUserDataUsage",value:function(e){e>0&&(this.usedByUser+=e)}},{key:"decreaseUserDataUsage",value:function(e){e>0&&(this.usedByUser-=e)}},{key:"resetUserDataUsage",value:function(){this.usedByUser=0}},{key:"onEvict",value:function(e){this.handlers.on("evict",e)}},{key:"usedBySystem",get:function(){var e=0;for(var t in this.usedByTable)e+=this.usedByTable[t];return e}},{key:"exceeded",get:function(){return this.usedBySystem+this.usedByUser-this.config.storageLimit}}]),e}();t.StorageManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=new WeakMap,o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.executable=t,this.timeout=n,i.set(this,null)}return r(e,[{key:"run",value:function(e){var t=this;!e&&!i.get(this)&&this.timeout>0?i.set(this,setTimeout(function(){i.set(t,null),t.executable()},this.timeout)):this.executable()}}]),e}();t.BatchUpdater=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Indexer=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),a=n(3);var s=function(e){for(var t in e)e[t]=e[t].replace("_","");return e.join("_")},l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexTable={}}return i(e,[{key:"hasIndex",value:function(e,t){var n=s(t);return this.indexTable[e]&&this.indexTable[e][n]}},{key:"createIndex",value:function(e,t){var n=s(t);return this.indexTable[e]||(this.indexTable[e]={}),this.indexTable[e][n]||(this.indexTable[e][n]=[]),0===this.indexTable[e][n].length}},{key:"removeIndex",value:function(e,t){var n=s(t);this.indexTable[e]&&this.indexTable[e][n]&&delete this.indexTable[e][n]}},{key:"findAppropriateIndexedColumns",value:function(e,t,n){var r={columns:[],match:0,orderBy:"none"};if(this.indexTable[e])for(var i in this.indexTable[e]){var a=0,s=i.split("_");for(var l in s){if(!(t.indexOf(s[l])>=0))break;var u=n.getOperators(s[l]);Array.isArray(u)?(u.indexOf(o.Command.EXACTLY_EQUAL)>=0||u.indexOf(o.Command.EQUAL)>=0||u.indexOf(o.Command.IS_NULL)>=0||parseInt(l)===s.length-1)&&a++:parseInt(l)===s.length-1?r.orderBy="column":r.orderBy="invalid"}a>=r.match&&(r.columns=s,r.match=a)}return r.match>0&&"invalid"!==r.orderBy?r.columns:[]}},{key:"queryKeys",value:function(e,t,n,r){var i=this;r||(r={});var o=[];if(this.indexTable[e]){var a=this.findAppropriateIndexedColumns(e,t,n);if(a.length>0){var l=!1,u=s(a);if(this.indexTable[e][u])for(var c=function(t){return r.reversed?t>=0:t<i.indexTable[e][u].length},f=function(e){return r.reversed?e-1:e+1},h=r.reversed?this.indexTable[e][u].length-1:0;c(h);h=f(h)){for(var d=this.indexTable[e][u][h].k,y=0;y<d.length;y++)if(n.match(d[y]))if(0===r.offset){if(o.push(d[y]),o.length===r.limit){l=!0;break}}else r.offset--;if(l)break}}}return o}},{key:"put",value:function(e,t,n){if(this.indexTable[e])for(var r in this.indexTable[e]){var i=r.split("_"),o=[];for(var s in i){var l=i[s];o.push(a.Filter.getValueForColumn(n,l))}for(var u=0,c=Object.keys(this.indexTable[e][r]).length,f=!1,h=0;u<c;){var d=0;h=parseInt((u+c)/2);var y=this.indexTable[e][r][h].v;for(var v in y)if(o[v]===y[v])d++;else{if(o[v]>y[v]){u=Math.min(c,h+1);break}if(o[v]<y[v]){c=Math.max(u,h-1);break}}if(d===o.length){f=!0,this.indexTable[e][r][h].k.indexOf(t)<0&&this.indexTable[e][r][h].k.push(t);break}}f||(h=u,this.indexTable[e][r].splice(h,0,{v:o,k:[t]}))}}},{key:"remove",value:function(e,t,n){if(n&&"object"===(void 0===n?"undefined":r(n)))for(var i in this.indexTable[e]){var o=i.split("_"),s=[];for(var l in o){var u=o[l];s.push(a.Filter.getValueForColumn(n,u))}for(var c in this.indexTable[e][i]){var f=this.indexTable[e][i][c].v,h=0;for(var d in f)s[d]===f[d]&&h++;if(h===s.length){for(var y in this.indexTable[e][i][c].k)if(this.indexTable[e][i][c].k[y]===t){this.indexTable[e][i][c].k.splice(y,1),0===this.indexTable[e][i][c].k.length&&this.indexTable[e][i].splice(c,1);break}break}}}}},{key:"reset",value:function(e){for(var t in this.indexTable[e])this.indexTable[e][t]=[]}}]),e}();t.Indexer=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o={boolean:"b",number:"n",string:"s",object:"o",null:"x",undefined:"u"},a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.val=t,this.type=n||o[void 0===t?"undefined":r(t)],this.type===o.object&&null===this.val&&(this.type=o.null)}return i(e,[{key:"serialize",value:function(){switch(this.type){case o.boolean:return this.val?"t":"f";case o.number:return this.val+"";case o.string:return this.val;case o.object:return JSON.stringify(this.val);case o.null:default:return""}}},{key:"deserialize",value:function(){switch(this.type){case o.boolean:return"t"===this.val;case o.number:return Number(this.val);case o.string:return this.val;case o.object:return""!==this.val?JSON.parse(this.val):null;case o.null:return null;case o.undefined:default:return}}}],[{key:"Type",get:function(){return o}}]),e}();t.Serializer=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=new WeakMap,o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i.set(this,{})}return r(e,[{key:"get",value:function(){return i.get(this)}},{key:"set",value:function(e){i.set(this,e)}},{key:"yield",value:function(e){var t=i.get(this),n=e[0].toLowerCase();for(var r in t[n]||(t[n]=[]),t[n])if(t[n][r].n===e)return t[n][r].c;var o=""+(n+(t[n].length+1));return t[n].push({n:e,c:o}),i.set(this,t),o}}]),e}();t.TableMapper=o}]).default});